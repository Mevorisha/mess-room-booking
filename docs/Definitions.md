# Definitions
- [Types](#types)
  - [Address](#address)
  - [Gender](#gender)
  - [Profession](#profession)
  - [TokenType](#tokentype)
  - [OtpType](#otptype)
- [Hard Entities](#hard-entities)
    - [Account](#account)
    - [Profile](#profile)
        - [Provider](#provider-owner)
        - [Tenant](#tenant)
    - [Room](#room)
    - [Booking](#booking)
- [Soft Entities](#soft-entities)
    - [Identity](#identity)
    - [Token](#token)
    - [OTP](#otp)
    - [Notification](#notification)
    - [Feedback](#feedback)
## Types
### Address
```
type Address {
  geoloc_lat float
  geoloc_lon float
  houseno string?
  landmark string?
  street string?
  city string
  pincode string
}
```
### Gender
```
enum Gender {
  MALE
  FEMALE
  OTHER
}
```
### Profession
```
enum Profession {
  STUDENT
  WORKING
}
```
### TokenType
```
enum TokenType {
  ACCESS
  REFRESH
}
```
### OtpType
```
enum OtpType {
  EMAIL
  MOBILE
}
```
## Hard Entities
### Account
```
Account {
  acoount_id string pk

  email string?
  email_isverified boolean

  country_code string
  mobile string unique
  mobile_isverified boolean

  expires_at Date
}
```

### Profile
#### Provider (Owner)
```
ProviderProfile {
  profile_id string pk
  account_id string fk unique

  profile_img string url
  first_name string
  last_name string
  profile_type string ROOM_PROVIDER

  expires_at Date
}
```

#### Tenant
```
TenantProfile {
  profile_id string pk
  account_id string fk unique

  profile_img string url
  first_name string
  last_name string
  profile_type string ROOM_TENANT

  gender Gender enum
  profession Profession enum
  room_mate_gender Gender enum
  room_mate_profession [Profession] Set[enum]

  work_locations [Address] [type]

  expires_at Date type
}
```
### Room
```
Room {
  room_id string pk
  provider_account_id string fk

  accepting_gender Gender enum
  accepting_profession [Profession] Set[enum]

  aadhaar_isrequired boolean
  workid_isrequired boolean

  address Address type
  image_urls [string] [url]
  facilities Map[string,string]
  price_per_occupant number
  max_occupants number

  expires_at Date type
}
```
### Booking
```
RoomBooking {
  roombook_id string pk
  tenant_account_id string fk
  room_id string fk
  occupied number

  aadhaar_url string? url
  workid_url string? url

  is_confirmed boolean

  expires_at Date type
}
```

## Soft Entities
### Identity
```
Identity {
  account_id string pk unique

  aadhaar_img string? url
  workid_img string? url

  expires_at Date
}
```
### Token
```
Token {
  token_id string pk
  account_id string fk

  token string
  token_type TokenType enum
  
  expires_at Date type
}
```
### OTP
```
OTP {
  otp_id string pk
  account_id string fk
  code string
  otp_type OtpType enum
  expires_at Date type
}
```
### Notification
```
Notification {
  notification_id string pk
  account_id string fk
  message string
  is_read boolean
  expires_at Date type
}
```
### Feedback
```
Feedback {
  feedback_id string pk
  account_id string fk
  message string
  image_urls [string] [url]
  expires_at Date type
}
```

# Additional Notes
- Account ID (`account_id`) is a system generated unique random 16 byte string containing 0-9 and A-Z (capital).
- Other ID are auto-generated UUIDs that may be handled by the database (if supported).
- Image URLs are only the unique path to the image in the storage. The complete path will be generated by the server using this path and some server-side secret.
- An API will be provided to upload images to the storage and get the URL path.
- All entities have an `expires_at` field to handle soft deletion. After the expiry date, the entity will be deleted from the database.
- Entities that should not be deleted (like `Account` and `Profile`) will have a expiry date of (CURRENT + 500) years.
- For `Room`, `Booking` and `Identity`, expiry date will also be set to (CURRENT + 500) years.
- If Account or Profile is deleted, expiry date will be set to (CURRENT + 30) days.
- If user logs in, expiry date will be set to (CURRENT + 500) years.
- For OTPs, expiry date will be set to (CURRENT + 5) minutes.
- For access tokens, expiry date will be set to (CURRENT + 1) hour.
- For refresh tokens, expiry date will be set to (CURRENT + 1) month.
- For notifications, expiry date will be set to (CURRENT + 30) days.
- If user reads the notification, `is_read` will be set to `true`.
- For feedback, expiry date will be set to (CURRENT + 5) months.
